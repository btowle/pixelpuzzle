<html>
<head>
<title>PixelPuzzle</title>
<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
 <script src="http://ajax.googleapis.com/ajax/libs/jqueryui/1.10.2/jquery-ui.min.js"></script>
<script>
var util = {
  idToValue: function(id){
    var strings = id.split("-");
    var ret = [parseInt(strings[1]), parseInt(strings[0])];
    return ret;
  }
}
var game = {
  guessArray: [],
  answerArray: [
    [0,0,1,1,1,1,1,0,0],
    [0,1,1,1,1,1,1,1,0],
    [1,1,0,1,1,0,1,1,1],
    [1,1,0,0,1,0,0,1,1],
    [1,1,1,1,1,1,1,1,1],
    [1,1,0,1,1,1,0,1,1],
    [1,1,1,0,0,0,1,1,1],
    [0,1,1,1,1,1,1,1,0],
    [0,0,1,1,1,1,1,0,0]
  ],
  clues: {
    columns: [],
    rows: []
  },
  setGuess: function(idstr, val){
    var id = util.idToValue(idstr);
    var set = 0;
    if(val){ set = 1; }
    game.guessArray[id[0]][id[1]] = set;
    game.checkPuzzle();
  },
  checkPuzzle: function(){
    var valid = true;
    var size = game.answerArray.length;
    for(var i=0; i < size; i++){
      for(var j=0; j < size; j++){
        if((game.answerArray[i][j] && !game.guessArray[i][j]) ||
           (!game.answerArray[i][j] && game.guessArray[i][j])){
          valid = false;
        }
      }
    }
    if(valid){
      alert('you win!');
    }
  },
  init: function(){
    //create guess array
    var size = game.answerArray.length;
    for(var i = 0; i < size; i++){
      game.guessArray[i] = new Array();
    }
    //produce clues
    var size = game.answerArray.length;
    var prevRow;
    var prevCol;
    for(var i=0; i < size; i++){
      var prevRow = 0;
      var prevCol = 0;
      game.clues.rows[i] = new Array();
      game.clues.columns[i] = new Array();
      for(var j=0; j < size; j++){
        if(game.answerArray[i][j]){
          if(prevRow){
            game.clues.rows[i][game.clues.rows[i].length-1]++;
          }else{
            game.clues.rows[i][game.clues.rows[i].length] = 1;
          }
          prevRow = 1;
        }else{
          prevRow = 0;
        }
        if(game.answerArray[j][i]){
          if(prevCol){
            game.clues.columns[i][game.clues.columns[i].length-1]++;
          }else{
            game.clues.columns[i][game.clues.columns[i].length] = 1;
          }
          prevCol = 1;
        }else{
          prevCol = 0;
        }
      }
    }
    //end produce clues
    //make clueString
    var clueString = '<div class="number-row">';
    for(var i=0; i < game.clues.columns.length; i++){
      clueString += '<div class="column-numbers"><div class="column-numbers-group">';
      for(var j=0; j < game.clues.columns[i].length; j++){
        clueString += '<div>'+game.clues.columns[i][j]+'</div>';
      }
      clueString += '</div></div>';
    }
    clueString += '</div><div class="number-column">';
    for(var i = 0; i < size; i++){
      clueString +='<div class="row-numbers">';
      for(var j = 0; j < game.clues.rows[i].length; j++){
        clueString += '<div>'+game.clues.rows[i][j]+'</div>';
      }
      clueString += '</div>';
    }
    clueString += '</div></div>';


    //make rowString
    var size = game.answerArray.length;
    var rowString = ' ';
    for(var i = 0; i < size; i++){
      rowString += '<div class="grid-row">';
      for(var j = 0; j < size; j++){
        rowString += '<div id="'+j+'-'+i+'" class="grid-cell">X</div>'
      }
      rowString += '</div>';
    }
    $('body').append(clueString);
    $('body').append('<div id="grid">');
    $('#grid').append(rowString);
    //$('body').append('<div id="grid">');
    //$('#grid').append(clueString+rowString);

  }
}
$(function(){
  game.init();
  $(".column-numbers-group > div, .row-numbers > div").click(function(){
    if($(this).hasClass('line-through')){
      $(this).removeClass('line-through');
    }else{
      $(this).addClass('line-through');
    }
  });
  $(".grid-cell").click(function(){
    if($(this).hasClass('yes')){
      $(this).removeClass('yes');
      $(this).addClass('no');
      game.setGuess(this.id, false);
    }else if($(this).hasClass('no')){
      $(this).removeClass('no');
    }else{
      $(this).addClass('yes');
      game.setGuess(this.id, true);
    }
  });
});
</script>
<style>
body{
  padding: 0;
  margin: 0;
}
#grid{
  width: 500px;
  height: 500px;
  position: absolute;
  left: 100px;
  top: 100px;
  -webkit-user-select:none;
}
.grid-row{
  width: 100%;
  height: 50px;
  clear: both;
  position: relative;
}
.grid-cell{
  width: 50px;
  height: 50px;
  float: left;
  text-align: center;
  position: relative;
  border: 1px solid black;
  color: #FFF;
  cursor:default;
}
.number-row{
  width: 100%;
  height: 100px;
  position: absolute;
  top: 0px;
  left: 122px;
}
.number-column{
  position: absolute;
  top: 122;
  left: 0;
}
.row-numbers{
  -webkit-user-select:none;
  cursor:default;
  width: 100px;
  height: 50px;
}
.row-numbers > div{
  float:right;
  padding: 4px;
}
.column-numbers-group{
  text-align: center;
  position: absolute;
  bottom: 0;
}
.column-numbers{
  width: 50px;
  height: 100%;
  float: left;
  -webkit-user-select:none;
  cursor:default;
}
.line-through{
  text-decoration: line-through;
}
.yes{
  background-color: #000;
  color: #000;
}
.no{
  background-color: #FCC;
  color: #FCC;
}
.column-break{
  clear: both;
}

</style>
</head>
<body>
</body>
</html>
